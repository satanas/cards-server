{{!< editor }}
<h1>Cards Gallery</h1>

<div id="gallery">
  <div class="buttons">
    <span>{{ cards.length }} registered cards</span>
    <a class="button" href="/cards/new">Add new card</a>
  </div>
  <table>
    <thead>
      <tr>
        <th>Image</th>
        <th>Name</th>
        <th>Mana</th>
        <th>Attack / Health</th>
        <th>First Strike</th>
        <th>Rush</th>
        <th>Overwhelm</th>
        <th>Deathtouch</th>
        <th>Curse</th>
        <th>Venom</th>
        <th>Transfusion</th>
        <th>Vampirism</th>
        <th>Berserker</th>
        <th>Flavor Text</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {{#cards}}
      <tr>
        <td><img src="/public/images/{{image}}" /></td>
        <td>{{name}}</td>
        <td>{{mana}}</td>
        <td>{{attack}} / {{health}}</td>
        <td>{{firstStrike}}</td>
        <td>{{rush}}</td>
        <td>{{overwhelm}}</td>
        <td>{{deathtouch}}</td>
        <td>{{curse}}</td>
        <td>{{venom}}</td>
        <td>{{transfusion}}</td>
        <td>{{vampirism}}</td>
        <td>{{berserker}}</td>
        <td>{{flavorText}}</td>
        <td>
          <a class="edit-link" href="/cards/{{_id}}" alt="Edit" title="Edit"><i class="fa fa-pencil-square-o"></i></a> | 
          <a class="delete-link" data-card-name="{{name}}" href="/cards/{{_id}}" alt="Delete" title="Delete"><i class="fa fa-trash-o"></i></a>
        </td>
      </tr>
      {{/cards}}
    </tbody>
  </table>
</div>

<script>
$(document).ready(function() {
  $('.delete-link').on('click', function(ev) {
    ev.preventDefault();
    if (window.confirm("Do you really want to delete '" + $(this).attr('data-card-name') + "' card?")) {
      $.ajax($(this).attr('href'), {
        method: 'delete',
        success: function(data) {
          if (data.redirect) {
            window.location = data.url;
          }
        },
        error: function(err) {
          var message = (err.hasOwnProperty('message')) ? err.message : 'Error deleting card';
          showMessage('alert', message);
        }
      });
    }
  });
});

{{#if flash}}
showMessage('{{ flash.type }}', '{{Â flash.message }}');
{{/if}}
</script>
